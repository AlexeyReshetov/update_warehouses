# Warehouse Stocks API

Этот проект представляет собой REST API для импорта и обновления остатков товаров по складам. Если склад найден, остатки обновляются, если склад не найден — остатки товаров суммируются и обновляют **общий остаток** (globalStocks).

## Описание

API принимает данные о складах и остатках товаров в формате JSON. При получении запроса:

1. **Если склад найден** — обновляются остатки товаров на складе.
2. **Если склад не найден** — остатки товаров для этого склада суммируются, и результат обновляет глобальные остатки в поле `globalStocks`.

## Требования

- PHP 7.4 или выше
- Поддержка авторизации Basic Auth

## Структура проекта

```bash
/project-root
    ├── index.php          # Основной файл для обработки запроса
    ├── stocks_data.json   # Файл для хранения остатков складов и глобальных остатков
    ├── auth.php           # Файл для проверки Basic Auth
    ├── README.md          # Этот файл
```
## Установка

1. Клонируйте репозиторий:

    ```bash
    git clone https://github.com/AlexeyReshetov/update_warehouses.git
    cd warehouse-stocks-api
    ```

2. Разверните проект на сервере, поддерживающем PHP, или используйте локальный сервер:

    ```bash
    php -S localhost:8080
    ```

3. Убедитесь, что файл `stocks_data.json` существует и доступен для записи на сервере. В нем будут храниться данные об остатках складов и глобальных остатках.

## Формат запроса

### URL
```
POST http://localhost:8080/index.php
```

### Тело запроса

Запрос должен содержать JSON-объект, который включает массив складов и остатков. Каждый склад описывается следующим образом:

```json
[
    {
        "uuid": "1234",
        "stocks": [
            {"uuid": "stock1", "quantity": 10},
            {"uuid": "stock2", "quantity": 5}
        ]
    },
    {
        "uuid": "5678",
        "stocks": [
            {"uuid": "stock3", "quantity": 20},
            {"uuid": "stock4", "quantity": 15}
        ]
    }
]
```

## Авторизация

Для работы с API используется **Basic Auth**. Логин и пароль должны быть указаны при отправке запроса.

### Пример:
- **Логин**: `admin`
- **Пароль**: `password`

В Postman или другой программе для работы с API необходимо выбрать **Basic Auth** и ввести эти данные.

## Логика обработки запроса

1. Если склад найден:
   - Остатки для каждого товара на складе обновляются (старые значения заменяются на новые).
   
2. Если склад не найден:
   - Остатки товаров для этого склада **суммируются**, и результат обновляет значение в **`globalStocks`**. Склад не создается.

Пример содержимого **`stocks_data.json`** после выполнения запроса:

```json
{
    "warehouses": {
        "1234": {
            "stocks": {
                "stock1": 15,
                "stock2": 10
            }
        }
    },
    "globalStocks": 22
}
```
## Ответ API

### Успешный запрос

Если запрос выполнен успешно, API вернет следующий ответ:

```json
{
    "success": true
}
```

### Ошибка

Если в запросе есть ошибки, API вернет ответ с описанием ошибок:

```json
{
    "success": false,
    "errors": ["Invalid JSON body"]
}
```

## Разработка

1. Для разработки и тестирования используйте локальный сервер на PHP:

    ```bash
    php -S localhost:8080
    ```

2. Разработанный код можно коммитить в Git, создавая соответствующие ветки для новых функций или исправлений.

## Вопросы и предложения

Если у вас есть вопросы или предложения по улучшению проекта, создайте [issue](https://github.com/AlexeyReshetov/update_warehouses/issues) на GitHub.
